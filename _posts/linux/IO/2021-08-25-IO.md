---
layout: page
title: I/O模型
tag: Linux/UNIX系统编程手册
---
# I/O模型
## 文件
---
所有执行I/O操作的系统调用都以文件描述符，一个非负整数（通常为小整数）来代指打开的文件。
#### 标准文件描述符  
文件描述符|用途|POSIX名称|stdio流
:--:|:--:|:--:|:--:|
0|标准输入|STDIN_FILENO|stdin
1|标准输出|STDOUT_FILENO|stdout
2|标准错误|STDERR_FILENO|stderr
|

程序开始之前，shell代表程序打开这3个文件描述符，大多数程序都期望能使用这三种标准文件描述符
## 通用IO
---
### 打开一个文件：open()
open()调用既能打开一个已存在的文件，也能创建并打开一个新文件。
```cpp
#include <sys/stat.h>
#include <fcntl.h>
int open(const char* pathname, int flag, .../*mode_t mode*/);
```
open()如果在调用成功之后，将会返回一个文件描述符，用于在后续函数调用中指代该文件。若发生错误则返回-1，并将errno置为相应的错误标志。  
参数pathname为要打开的文件，若为符号链接，会对其进行解引用。  
参数flag为位掩码，用于指定文件的访问模式。
访问模式|描述
:--:|:--:
O_RDONLY|以只读方式打开文件
OWRONLY|以只写方式打开文件
ORDWR|以读写方式打开文件
|

`O_RDWR并不等同于O_RDONLY|O_WRONLY，后者属于逻辑错误`
#### open()调用中的flag参数
标志|用途|统一UNIX规范版本
:--:|:--:|:--:|
O_RDONLY|以只读的方式打开|V3
O_WRONLY|以只写的方式打开|V3
O_RDWR|以读写的方式打开|V3
|
O_CLOEXEC|设置close-on-exec标志|V4
O_CREAT|若文件不存在则创建之|V3
O_DIRECT|无缓冲的输入/输出|
O_DIRECTORY|如果pathname不是目录，则失败|V4
O_EXCL|结合OREAT参数使用，专门用于创建文件|V3
O_LARGEFILE|在32位系统中使用此标志打开大文件|
O_NOATIME|调用read()时，不修改文件最近访问时间|
O_NOCTTY|不要让pathname所指向的设备终端成为控制终端|V3
O_NOFOLLOW|对符号链接不予解引用|V4
O_TRUNC|截断已有文件，使其长度为零|V3
O_APPEND|总在文件尾部追加数据|V3
O_ASYNC|当I/O操作可行时，产生信号通知进程|
O_DSYNC|提供同步的I/O数据完整性|V3
O_NONBLOCK|以非阻塞方式打开|V3
O_SYNC|以同步方式写文件|V3
|

